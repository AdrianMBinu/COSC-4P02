<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URLs</title>

    <script type="module">

        function setUid(user) {
            if (user) {
                window.globalVariable = user.uid;
            } else {
                window.globalVariable = "Non";
            }
            console.log(window.globalVariable)
        }
            import {onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.6/firebase-auth.js";
            import { auth } from '../js/firebase-init.js';
            window.onload = function() {
              onAuthStateChanged(auth, (user) => {
                  if (user) {
                       setUid(user)
                  } else {
                    setUid()
                  }
              });
              fetchUrls();
          };
        
        
          </script>
    </body>
</head>
<body>
    <h1>URLs</h1>
    <table id="urlTable">
        <thead>
            <tr>
                <th>Long URL</th>
                <th>Short URL</th>
                <th>Click Count</th>
            </tr>
        </thead>
        <tbody id="urlList">
            <!-- URL records will be inserted here -->
        </tbody>
    </table>

    <script>

    function fetchUrls() {
        // Fetch URLs from the server
        fetch('https://cosc4p02.tpgc.me/u/urls', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
        })
        .then(response => response.json())
        .then(urls => {
            const urlList = document.getElementById('urlList');

            // Filter and display URLs with matching userId
            urls.forEach(url => {
                //if (url.userId === window.globalVariable) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${url.longUrl}</td>
                        <td><a href="https://cosc4p02.tpgc.me/u/${url.shortCode}" target="_blank">${url.shortCode}</a></td>
                        <td>${url.clickCount}</td>
                        <td>${url.userId}</td>
                    `;
                    urlList.appendChild(row);
                //}
            });
        })
        .catch(error => console.error('Error fetching URLs:', error));
    }
    </script>
</html>
